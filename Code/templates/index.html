{% extends "base.html" %}
{% block content %}

<!-- Dashboard Tiles -->
<div class="tiles-row">
  <a href="{{ url_for('applications.list_applications') }}" class="tile tile-dark1">
    <div class="tile-title">Applications</div>
    <div class="tile-number">{{ rows|length }}</div>
    <div class="tile-hint">View & manage all</div>
  </a>

  <a href="{{ url_for('stats.stats') }}" class="tile tile-dark2">
    <div class="tile-title">Statistics</div>
    <div class="tile-number">{{ counts['Accepted'] }}/{{ total }}</div>
    <div class="tile-hint">
      Success rate:
      {{ '%.1f'|format((counts['Accepted'] / total * 100) if total else 0) }}%
    </div>
  </a>
</div>

<!-- Status Overview Card -->
<div class="card status-card">
  <div class="card-header">
    <h2 class="section-title">Application Status</h2>
    <a href="{{ url_for('stats.stats') }}" class="header-link">View analytics</a>
  </div>

  <div class="status-list">
    {% set order = ['Pending','Interview','Accepted','Rejected','No Answer'] %}
    {% for label in order %}
      {% set value = counts[label] %}
      {% set pct = (value / total * 100) if total else 0 %}
      <a href="{{ url_for('applications.list_applications', filter=label) }}" class="status-row">
        <!-- Left: Pill + Count -->
        <div class="status-left">
          <span class="status-pill {{ label|lower|replace(' ','') }}">{{ label }}</span>
          <span class="count-text">{{ value }}</span>
        </div>

        <!-- Right: Progress bar + Percentage -->
        <div class="status-right">
          <div class="progress-bar">
            <!-- NOTE: pass percent as data attribute (no inline CSS Jinja) -->
            <div class="progress-fill {{ label|lower|replace(' ','') }}"
                 data-pct="{{ '%.2f'|format(pct) }}"></div>
          </div>
          <span class="percentage">{{ '%.0f'|format(pct) }}%</span>
        </div>
      </a>
    {% endfor %}
  </div>
</div>

<!-- Recent Activity Card -->
<div class="card activity-card">
  <div class="card-header">
    <h2 class="section-title">Recent Activity</h2>
    {% if rows|length > 0 %}
      <a href="{{ url_for('applications.list_applications') }}" class="header-link">View all</a>
    {% endif %}
  </div>

  {% if rows|length == 0 %}
    <div class="empty-state">
      <h3>No applications yet</h3>
      <p class="muted">Add your first job application to get started</p>
      <a href="{{ url_for('applications.new') }}" class="btn">Add Application</a>
    </div>
  {% else %}
    <div class="activity-list">
      {% for r in rows[:5] %}
        <div class="activity-item">
          <div class="activity-content">
            <div class="activity-title">{{ r.position }}</div>
            <div class="activity-subtitle">{{ r.company }}</div>
          </div>
          <span class="status-pill {{ r.status|lower|replace(' ','') }}">{{ r.status }}</span>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>

<!-- Quick Actions -->
<div class="actions">
  <a href="{{ url_for('applications.list_applications') }}" class="btn">My Applications</a>
  <a href="{{ url_for('applications.new') }}" class="btn-outline">Add New</a>
</div>

<!-- Set progress widths from data-pct (prevents CSS-linter errors) -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.progress-fill[data-pct]').forEach(el => {
      const pct = parseFloat(el.dataset.pct || '0') || 0;
      el.style.width = pct + '%';
    });
  });
</script>

{% endblock %}
